# 任务19：端口转发；SSH隧道；

2023这块内容的权重提高。本章节重点讲解ssh端口转发和隧道的做法

## 概念

端口转发是一对一将内部端口映射到外网,隧道可以实现全端口映射

网络架构拓扑图：

- 外网:192.168.0.0/24
- 内网:192.168.1.0/24

设备有三台:

- PC1:外网设备.eth0:192.168.0.1
- PC2:边界设备.eth0:192.168.0.2;边界设备.eth1:192.168.1.1
- PC3:内网设备.eth0:192.168.1.2

## 端口转发

**本地端口转发**

下列命令是在`PC2`上进行操作，将`PC3.eth0`的`80`端口转发到`PC2.eth1`的`8080`。`PC1`通过访问`PC2`的`8080`即可访问到内网`PC3`的`80`

PC2:`ssh -N -L 192.168.0.2:8080:192.168.1.2:80 $user@192.168.1.2`

**反向端口转发**

下列命令是在`PC3`(内网设备)上进行操作，将`PC3.eth0`的`80`端口转发到`PC2.lo`的`8080`。`PC2`通过访问`127.0.0.1:8080`的即可访问到内网`PC3`的`80`

PC3:`ssh -N -R 0.0.0.0:8080:192.168.1.2:80 $user@192.168.1.1`

在`PC2`再利用本地端口转发即将`PC2.lo:8080`转发到外网应用`PC1`

## 隧道

**正向代理**

下列命令是在`PC2`上进行操作，`PC2.eth0`的`8848`端口将会作为代理，`PC1`可以通过**proxychains**或者**浏览器代理**指定`PC2.eth0`的`8848`进行sock代理,即可将流量转发到内网`PC3`.

PC2:`ssh -N -D 192.168.0.2:8848 $user@192.168.1.2`

**反向代理**

下列命令是在`PC3`(内网设备)上进行操作，`PC2.lo0`的`8848`将会作为代理转发到`PC3`，`PC2`可以通过**proxychains**或者**浏览器代理**指定`PC2.lo0`的`8848`进行sock代理,即可将流量转发到内网`PC3`

PC3:`ssh -N -R 8848 $user@192.168.1.1`

再PC2利用正向代理将`PC2.lo`的`8848`即可将`PC3`的内网应用转发到`PC1`

## 其他

[桥链接模式分配ip问题](https://blog.csdn.net/kande0707/article/details/124702282)