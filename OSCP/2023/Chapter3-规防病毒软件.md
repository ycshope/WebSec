# 任务10：AV 检测技术；

## 概述

厂商之间可能会一定程度上共享病毒样本，比如virustotal,但这个网站会将病毒同步到所有厂商所以如果想本地验证效果那么推荐用antiscan。目前windows采用的是云端+人工智能查杀,效果比较好,如果希望本地做病毒研究需要关闭`病毒和威胁防护`设置种的`自动样本提交`以防样本泄漏

## 考试要求

理论上理解，简单现成工具的使用

## 防病毒厂商的检测方法

### 基于字节特征的检测方法

基于字符串特征的黑名单,单av厂商会经常更新特征码,各个厂商的特征码也不太一样,所以很难找到通用的免杀方法。



### 启发式检测方法？

基于规则和算法判断软件的行为是否为恶意,通常通过调试或者反编译源码来实现。



### 基于行为的检测方法

动态分析程序的运行,在模拟环境中执行程序(虚拟机)



### 小结

后两种都可以一定程度上发现未知病毒,目前大部分av都是基于三种方法综合检测



## AV绕过技术的两大分类

主要分为磁盘类和内存类,av的磁盘病毒检测手段比较成熟,内存类病毒躲避查杀是目前主要技术趋势。

### 磁盘中的躲避技术

- 打包：打包后特征码不同,但不足以规避目前主流AV软件的查杀
- 混淆：这种方法会增加逆向分析难度,对于基于特征码的检测方法比较有效
- 加密：目前最有效的反病毒措施之一,执行时在内容中解密之执行代码,磁盘中只有加密的文件。
- 软件保护：综合了上述的方法,由于技术比较复杂,没有没有开园AV规避产品

### 内存中的躲避技术

内存中注入也叫PE injection,是目前主流的AV规避技术

远程进程内存注入技术的实现原理:利用window api,向正常pe进程注入攻击代码,在原有的进程新申请个空间写入恶意代码。

- 反射DLL注入技术：攻击者自行开发API从内容中直接加载DLL(windows的公开api没有公布这类api)
- 进程挖空技术：攻击者首先在刮起状态下启动一个非恶意进程，从内容中删除进程的映像并替换为恶意程序映像,然后再恢复进行执行恶意代码。
- 内连挂载技术：修改内存并在函数中引入一个恶意钩子执行恶意代码



# 任务11：AV躲避技术；Shellter；

该部分未动手实验

## 考试要求

这块不会太难,能绕过小红伞avira(开源杀毒软件)就行。考试的难度基本用sheller都能绕过

## powershell内存注入

在原有进程利用新线程申请一块内存用于执行恶意代码

## shellter

目前流行的免费动态shellcode注入工具,是基于windows平台(linux上可以用wine进行翻译),能一定程度绕过杀毒软件。

**原理**

在正在文件插一段恶意代码,当程序运行时不影响原来的程序,但是会执行恶意代码。